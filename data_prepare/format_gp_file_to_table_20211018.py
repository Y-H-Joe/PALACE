#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Oct 18 21:52:24 2021

@author: Yihang Zhou

Contact: yihangjoe@foxmail.com
         https://github.com/Y-H-Joe/

####============================ description ==============================####

=================================== input =====================================
394.254763909.gp.xml file:
<?xml version="1.0" encoding="UTF-8"  ?>
<!DOCTYPE GBSet PUBLIC "-//NCBI//NCBI GBSeq/EN" "https://www.ncbi.nlm.nih.gov/dtd/NCBI_GBSeq.dtd">
<GBSet>
  <GBSeq>

    <GBSeq_locus>COAA_SINFN</GBSeq_locus>
    <GBSeq_length>331</GBSeq_length>
    <GBSeq_moltype>AA</GBSeq_moltype>
    <GBSeq_topology>linear</GBSeq_topology>
    <GBSeq_division>BCT</GBSeq_division>
    <GBSeq_update-date>02-JUN-2021</GBSeq_update-date>
    <GBSeq_create-date>28-JUL-2009</GBSeq_create-date>
    <GBSeq_definition>RecName: Full=Pantothenate kinase; AltName: Full=Pantothenic acid kinase</GBSeq_definition>
    <GBSeq_primary-accession>C3MBB9</GBSeq_primary-accession>
    <GBSeq_accession-version>C3MBB9.1</GBSeq_accession-version>
    <GBSeq_other-seqids>
      <GBSeqid>sp|C3MBB9.1|COAA_SINFN</GBSeqid>
      <GBSeqid>gi|254763909</GBSeqid>
    </GBSeq_other-seqids>
    <GBSeq_keywords>
      <GBKeyword>ATP-binding</GBKeyword>
      <GBKeyword>Coenzyme A biosynthesis</GBKeyword>
      <GBKeyword>Cytoplasm</GBKeyword>
      <GBKeyword>Kinase</GBKeyword>
      <GBKeyword>Nucleotide-binding</GBKeyword>
      <GBKeyword>Reference proteome</GBKeyword>
      <GBKeyword>Transferase</GBKeyword>
    </GBSeq_keywords>
    <GBSeq_source>Sinorhizobium fredii NGR234</GBSeq_source>
    <GBSeq_organism>Sinorhizobium fredii NGR234</GBSeq_organism>
    <GBSeq_taxonomy>Bacteria; Proteobacteria; Alphaproteobacteria; Hyphomicrobiales; Rhizobiaceae; Sinorhizobium/Ensifer group; Sinorhizobium</GBSeq_taxonomy>
    <GBSeq_references>
      <GBReference>
        <GBReference_reference>1</GBReference_reference>
        <GBReference_position>1..331</GBReference_position>
        <GBReference_authors>
          <GBAuthor>Schmeisser,C.</GBAuthor>
          <GBAuthor>Liesegang,H.</GBAuthor>
          <GBAuthor>Krysciak,D.</GBAuthor>
          <GBAuthor>Bakkou,N.</GBAuthor>
          <GBAuthor>Le Quere,A.</GBAuthor>
          <GBAuthor>Wollherr,A.</GBAuthor>
          <GBAuthor>Heinemeyer,I.</GBAuthor>
          <GBAuthor>Morgenstern,B.</GBAuthor>
          <GBAuthor>Pommerening-Roser,A.</GBAuthor>
          <GBAuthor>Flores,M.</GBAuthor>
          <GBAuthor>Palacios,R.</GBAuthor>
          <GBAuthor>Brenner,S.</GBAuthor>
          <GBAuthor>Gottschalk,G.</GBAuthor>
          <GBAuthor>Schmitz,R.A.</GBAuthor>
          <GBAuthor>Broughton,W.J.</GBAuthor>
          <GBAuthor>Perret,X.</GBAuthor>
          <GBAuthor>Strittmatter,A.W.</GBAuthor>
          <GBAuthor>Streit,W.R.</GBAuthor>
        </GBReference_authors>
        <GBReference_title>Rhizobium sp. strain NGR234 possesses a remarkable number of secretion systems</GBReference_title>
        <GBReference_journal>Appl Environ Microbiol 75 (12), 4035-4045 (2009)</GBReference_journal>
        <GBReference_xref>
          <GBXref>
            <GBXref_dbname>doi</GBXref_dbname>
            <GBXref_id>10.1128/AEM.00515-09</GBXref_id>
          </GBXref>
        </GBReference_xref>
        <GBReference_pubmed>19376903</GBReference_pubmed>
        <GBReference_remark>NUCLEOTIDE SEQUENCE [LARGE SCALE GENOMIC DNA].;&#xa;STRAIN=NBRC 101917 / NGR234</GBReference_remark>
      </GBReference>
    </GBSeq_references>
    <GBSeq_comment>[CATALYTIC ACTIVITY] Reaction=(R)-pantothenate + ATP = (R)-4&apos;-phosphopantothenate + ADP + H(+); Xref=Rhea:RHEA:16373, ChEBI:CHEBI:10986, ChEBI:CHEBI:15378, ChEBI:CHEBI:29032, ChEBI:CHEBI:30616, ChEBI:CHEBI:456216; EC=2.7.1.33; Evidence={ECO:0000255|HAMAP-Rule:MF_00215}.; [PATHWAY] Cofactor biosynthesis; coenzyme A biosynthesis; CoA from (R)-pantothenate: step 1/5. {ECO:0000255|HAMAP-Rule:MF_00215}.; [SUBCELLULAR LOCATION] Cytoplasm {ECO:0000255|HAMAP-Rule:MF_00215}.; [SIMILARITY] Belongs to the prokaryotic pantothenate kinase family. {ECO:0000255|HAMAP-Rule:MF_00215}.</GBSeq_comment>
    <GBSeq_source-db>UniProtKB: locus COAA_SINFN, accession C3MBB9;; class: standard.; created: Jul 28, 2009.; sequence updated: Jun 16, 2009.; annotation updated: Jun 2, 2021.; xrefs: CP001389.1, ACP27128.1, WP_012709875.1, YP_002827881.1; xrefs (non-sequence databases): SMR:C3MBB9, STRING:394.NGR_c33980, EnsemblBacteria:ACP27128, EnsemblBacteria:ACP27128, EnsemblBacteria:NGR_c33980, KEGG:rhi:NGR_c33980, PATRIC:fig|394.7.peg.6247, eggNOG:COG1072, HOGENOM:CLU_053818_1_1_5, OMA:RKYTQVS, OrthoDB:1793376at2, UniPathway:UPA00241, Proteomes:UP000001054, GO:0005737, GO:0005524, GO:0004594, GO:0015937, CDD:cd02025, HAMAP:MF_00215, InterPro:IPR027417, InterPro:IPR004566, InterPro:IPR006083, PANTHER:PTHR10285:SF139, Pfam:PF00485, PIRSF:PIRSF000545, SUPFAM:SSF52540, TIGRFAMs:TIGR00554</GBSeq_source-db>
    <GBSeq_feature-table>
      <GBFeature>
        <GBFeature_key>source</GBFeature_key>
        <GBFeature_location>1..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>1</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>organism</GBQualifier_name>
            <GBQualifier_value>Sinorhizobium fredii NGR234</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>taxon:394</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>gene</GBFeature_key>
        <GBFeature_location>1..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>1</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>gene</GBQualifier_name>
            <GBQualifier_value>coaA</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>locus_tag</GBQualifier_name>
            <GBQualifier_value>NGR_c33980</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Protein</GBFeature_key>
        <GBFeature_location>1..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>1</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>product</GBQualifier_name>
            <GBQualifier_value>Pantothenate kinase</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>EC_number</GBQualifier_name>
            <GBQualifier_value>2.7.1.33</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>Pantothenic acid kinase</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>UniProtKB_evidence</GBQualifier_name>
            <GBQualifier_value>Inferred from homology</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>calculated_mol_wt</GBQualifier_name>
            <GBQualifier_value>37328</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Region</GBFeature_key>
        <GBFeature_location>1..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>1</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>region_name</GBQualifier_name>
            <GBQualifier_value>Mature chain</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>Pantothenate kinase. /id=PRO_1000124803.</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Region</GBFeature_key>
        <GBFeature_location>21..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>21</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>region_name</GBQualifier_name>
            <GBQualifier_value>PRK05439</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>pantothenate kinase; Provisional</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>CDD:235466</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Region</GBFeature_key>
        <GBFeature_location>95..331</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>95</GBInterval_from>
            <GBInterval_to>331</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>region_name</GBQualifier_name>
            <GBQualifier_value>Udk</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>Uridine kinase [Nucleotide transport and metabolism]; COG0572</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>CDD:223645</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Site</GBFeature_key>
        <GBFeature_location>109..116</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>109</GBInterval_from>
            <GBInterval_to>116</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>site_type</GBQualifier_name>
            <GBQualifier_value>np-binding</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>ATP. /evidence=ECO:0000255|HAMAP-Rule:MF_00215.</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Site</GBFeature_key>
        <GBFeature_location>order(112,115..118,253,257,317,321)</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_point>112</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_from>115</GBInterval_from>
            <GBInterval_to>118</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>253</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>257</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>317</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>321</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_operator>order</GBFeature_operator>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>site_type</GBQualifier_name>
            <GBQualifier_value>other</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>ATP-binding site [chemical binding]</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>CDD:238983</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Site</GBFeature_key>
        <GBFeature_location>order(115..116,120,191,257,261,321)</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_from>115</GBInterval_from>
            <GBInterval_to>116</GBInterval_to>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>120</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>191</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>257</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>261</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>321</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_operator>order</GBFeature_operator>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>site_type</GBQualifier_name>
            <GBQualifier_value>other</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>CoA-binding site [chemical binding]</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>CDD:238983</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
      <GBFeature>
        <GBFeature_key>Site</GBFeature_key>
        <GBFeature_location>order(116,213)</GBFeature_location>
        <GBFeature_intervals>
          <GBInterval>
            <GBInterval_point>116</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
          <GBInterval>
            <GBInterval_point>213</GBInterval_point>
            <GBInterval_accession>C3MBB9.1</GBInterval_accession>
          </GBInterval>
        </GBFeature_intervals>
        <GBFeature_operator>order</GBFeature_operator>
        <GBFeature_quals>
          <GBQualifier>
            <GBQualifier_name>site_type</GBQualifier_name>
            <GBQualifier_value>other</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>note</GBQualifier_name>
            <GBQualifier_value>Mg2+-binding site [ion binding]</GBQualifier_value>
          </GBQualifier>
          <GBQualifier>
            <GBQualifier_name>db_xref</GBQualifier_name>
            <GBQualifier_value>CDD:238983</GBQualifier_value>
          </GBQualifier>
        </GBFeature_quals>
      </GBFeature>
    </GBSeq_feature-table>
    <GBSeq_sequence>msiaakdiepgdipgnltggefspyhvfsaeewsrfradtpltltgeevkrlrslndpvdlgevrriylslsrllsahveasqilfqqrkrflsmsdetktpfvigiagsvavgksttarilaellarwpsspkvdlittdgflypnailqrdnmmdrkgfpesydigallrflsaikagrpnvkaptyshltydvipdqfqlidrpdilifeginvlqsrdlpadgkivpmvsdffdfsiyidaeeslihnwyvsrfmrlretafqnpqsffhrystisedaaraiaeglwhninlknlhqniqptrpradlilqkgpshltqtvalrkl</GBSeq_sequence>
  </GBSeq>

</GBSet>
=================================== output ====================================
taxaID,EnsemblBacteria,name,GI,UnitProtID,Pfam,eggNOG,CDD,PIRSF,OrthoDB,EC,GO,seq
394,ACP27128;ACP27128;NGR_c33980,Pantothenate kinase,254763909,C3MBB9,PF00485,COG1072,cd02025,PIRSF000545,1793376at2,2.7.1.33,0005737;0005524;0004594;0015937,msiaakdiepgdipgnltggefspyhvfsaeewsrfradtpltltgeevkrlrslndpvd...
================================= parameters ==================================

=================================== example ===================================

=================================== warning ===================================

####=======================================================================####
"""
import xml.etree.ElementTree as ET
from itertools import islice
import re
import sys
import os

dp=sys.argv[1]
basename=os.path.basename(dp)
#dp="394.254763909.gp.xml"
#dp='country_data.xml'
dp_list=basename.split('.')
taxaID=dp_list[0]
GI=dp_list[1]

name=''
UnitProtID=''
Pfam=''
eggNOG=''
CDD=''
PIRSF=''
OrthoDB=''
EC=''
GO=''
seq=''
EnsemblBacteria=''

tree = ET.parse(dp)
root = tree.getroot()
for child in root[0]:
    ## name
    if child.tag=="GBSeq_definition":
        name=child.text
        try:
            name=[x.strip() for x in re.split(";|=",name)][1]
        except:
            name=[x.strip() for x in re.split(";|=",name)][0]
    
    ## UnitProtID
    if child.tag=='GBSeq_primary-accession':
        UnitProtID=child.text
        
    if child.tag=='GBSeq_source-db':
        db_annotation=child.text
        db_annotation_list=[x.strip() for x in re.split(',|:|;',db_annotation)]
        for count,value in enumerate(db_annotation_list):
            ## eggNOG
            if value.lower()=='eggnog':
                eggNOG=eggNOG+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## GO
            if value.lower()=='go':
                GO=GO+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## Pfam
            if value.lower()=='pfam':
                Pfam=Pfam+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## CDD
            if value.lower()=='cdd':
                CDD=CDD+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## PIRSF
            if value.lower()=='pirsf':
                PIRSF=PIRSF+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## OrthoDB
            if value.lower()=='orthodb':
                OrthoDB=OrthoDB+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
            ## EnsemblBacteria
            if value.lower()=='ensemblbacteria':
                EnsemblBacteria=EnsemblBacteria+";"+db_annotation_list[count+1]
                next(islice(db_annotation_list,1,1), None)
    
    ## EC
    if child.tag=='GBSeq_feature-table':
        for GBQualifier in child.findall('./GBFeature/GBFeature_quals/GBQualifier'):
            if GBQualifier.find('GBQualifier_name').text=='EC_number':
                EC=EC+';'+GBQualifier.find('GBQualifier_value').text
    
    ## seq
    if child.tag=="GBSeq_sequence":
        seq=seq+";"+child.text

output=str(','.join([x.strip(';') for x in [taxaID,EnsemblBacteria,name,GI,UnitProtID,Pfam,eggNOG,CDD,PIRSF,OrthoDB,EC,GO,seq]]))
print(output)
